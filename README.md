# QRKot - Благотворительный фонд поддержки котиков

## Описание проекта

QRKot - это API для благотворительного фонда, который собирает пожертвования на различные целевые проекты помощи котикам. Приложение позволяет создавать благотворительные проекты и собирать на них средства через пожертвования.

## Особенности проекта

- Распределение пожертвований по проектам (принцип FIFO — First In, First Out);
- Закрытие проектов при достижении необходимой суммы;
- Система ролей пользователей (обычные пользователи и суперпользователи);
- Аутентификация на основе JWT-токенов;
- Управление благотворительными проектами (CRUD);
- Асинхронное взаимодействие с базой данных.

## Технологический стек

- FastAPI
- SQLAlchemy
- Alembic
- Pydantic
- FastAPI Users
- Pytest

## Запуск проекта

### Предварительные требования

- Python 3.9+
- pip

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта:

```bash
# Общие настройки приложения
APP_TITLE=QRKot
DESCRIPTION=Благотворительный фонд поддержки котиков

# База данных
DATABASE_URL=sqlite+aiosqlite:///./fastapi.db
RESET_DATABASE=False

# Настройки безопасности
SECRET=ваш_секретный_ключ_для_jwt

# Настройки первого суперпользователя
FIRST_SUPERUSER_EMAIL=admin@example.com
FIRST_SUPERUSER_PASSWORD=admin
```

### Запуск миграций

```bash
alembic upgrade head
```

### Запуск приложения

```bash
uvicorn app.main:app --reload
```

## API Endpoints

После запуска приложения документация API будет доступна по адресу:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### Основные эндпоинты:

#### Пользователи и аутентификация:
- `POST /auth/register` - Регистрация нового пользователя
- `POST /auth/jwt/login` - Авторизация и получение токена
- `GET /users/me` - Информация о текущем пользователе

#### Благотворительные проекты (только для суперпользователей):
- `GET /charity_project/` - Получить список всех проектов
- `POST /charity_project/` - Создать новый проект
- `PATCH /charity_project/{project_id}` - Обновить проект
- `DELETE /charity_project/{project_id}` - Удалить проект

#### Пожертвования:
- `GET /donation/` - Получить список всех пожертвований (админ)
- `GET /donation/my` - Получить список своих пожертвований
- `POST /donation/` - Сделать пожертвование

## Механика работы сервиса

1. Пользователи могут делать пожертвования без указания целевого проекта
2. Суперпользователи могут создавать, обновлять и удалять благотворительные проекты
3. При внесении средств в проект, они автоматически распределяются по существующим проектам:
   - Сначала инвестируются в самый старый и незакрытый проект
   - Если средств больше чем нужно, остаток переходит на следующий проект
   - Когда проект закрывается, он автоматически помечается как завершенный
4. При создании проекта система проверяет имеющиеся непотраченные пожертвования и распределяет их

## Тестирование

```bash
pytest
```

## Структура проекта

```
app/
├── api/
│   ├── endpoints/          # API маршруты
│   ├── services.py         # Бизнес-логика
│   ├── validators.py       # Валидаторы
│   └── routers.py          # Основной роутер
├── core/                   # Ядро приложения
├── crud/                   # CRUD операции
├── models/                 # Модели базы данных
└── schemas/                # Pydantic-схемы
alembic/                    # Миграции
```